# Инструкция по установке и запуску проекта EventFlow

## Описание проекта

EventFlow - это система управления мероприятиями с возможностью регистрации посетителей, отметки посещаемости и управления новостями. Проект построен на стеке Laravel (PHP) + Vue.js (Frontend) + SQLite (База данных).

## Системные требования

- PHP 8.2 или выше
- Composer
- Node.js 16+ и npm
- SQLite (входит в комплект PHP)
- Git (для клонирования репозитория)

## Установка и настройка

### Шаг 1: Установка зависимостей

1. Установите PHP зависимости:
```bash
composer install
```

2. Установите JavaScript зависимости:
```bash
npm install
```

### Шаг 2: Настройка окружения

1. Скопируйте файл `.env.example` в `.env`:
```bash
cp .env.example .env
```

2. Сгенерируйте ключ приложения:
```bash
php artisan key:generate
```

### Шаг 3: Настройка базы данных

Проект использует SQLite базу данных, которая уже настроена в файле `.env`:
```
DB_CONNECTION=sqlite
```

Убедитесь, что файл базы данных существует:
```bash
touch database/database.sqlite
```

### Шаг 4: Запуск миграций и сидов

1. Запустите миграции для создания таблиц:
```bash
php artisan migrate
```

2. Заполните базу данных тестовыми данными:
```bash
php artisan db:seed
```

Это создаст следующих пользователей:

**Администратор:**
- Логин: `k.pereskokov`
- Пароль: `AdminPassword123!`

**Организаторы:**
- Логин: `i.ivanov`, `m.petrova`, `a.sidorov`
- Пароль для всех: `Password123!`

**Посетители:**
- Логин: `a.smirnova`, `d.kuznetsov`, `e.popova`, `m.lebedev`, `o.novikova`
- Пароль для всех: `StudentPassword123!`

### Шаг 5: Сборка фронтенда

1. Для разработки:
```bash
npm run dev
```

2. Для продакшена:
```bash
npm run build
```

## Запуск проекта

### Вариант 1: Использование встроенного сервера Laravel

1. Запустите сервер Laravel:
```bash
php artisan serve
```

2. В новом терминале запустите Vite для фронтенда:
```bash
npm run dev
```

3. Откройте в браузере: http://localhost:8000

### Вариант 2: Использование всех сервисов одной командой

Запустите все необходимые сервисы одной командой:
```bash
php artisan dev
```

Эта команда запустит:
- Laravel сервер на порту 8000
- Очередь задач
- Логи в реальном времени
- Vite для фронтенда

## Использование Telegram бота

Проект включает Telegram бота для отметки посетителей на мероприятиях.

### Настройка туннеля с помощью Pinggy

1. Запустите Laravel сервер:
```bash
php artisan serve
```

2. В новом терминале запустите Pinggy туннель:
```bash
ssh -p 443 -R0:localhost:8000 a.pinggy.io
```

3. Скопируйте полученный URL (например: `https://abc123.a.pinggy.link`)

4. Обновите `APP_URL` в файле `.env`:
```
APP_URL=https://abc123.a.pinggy.link
```

5. Перезапустите Laravel сервер:
```bash
php artisan serve
```

6. Установите webhook для Telegram бота:
```bash
php artisan telegram:set-webhook https://abc123.a.pinggy.link/api/telegram/webhook
```

7. Проверьте установку webhook:
```bash
php artisan telegram:webhook-info
```

### Использование бота

1. Откройте Telegram
2. Найдите вашего бота
3. Отправьте команду `/start`
4. Введите логин и пароль организатора
5. Выберите мероприятие для отметки посетителей

## Структура проекта

```
app/                    # PHP код приложения
  Http/Controllers/     # Контроллеры
  Models/               # Модели данных
  Console/Commands/     # Консольные команды
bootstrap/              # Файлы загрузки приложения
config/                 # Конфигурационные файлы
database/               # Миграции и сиды
public/                 # Публичные файлы
resources/              # Фронтенд ресурсы
  js/                   # JavaScript/Vue код
  css/                  # Стили
routes/                 # Маршруты
storage/                # Хранилище файлов
tests/                  # Тесты
```

## Основные функции

### Для администратора:
- Управление пользователями (создание, редактирование, блокировка)
- Управление новостями (создание, редактирование, удаление)
- Просмотр отчетов по мероприятиям

### Для организаторов:
- Создание и управление мероприятиями
- Отметка посетителей через веб-интерфейс или Telegram бота
- Просмотр статистики мероприятий

### Для посетителей:
- Просмотр доступных мероприятий
- Регистрация на мероприятия
- Просмотр истории посещений
- Оценка мероприятий

## Решение

### 1. Ошибка "Class not found"
Запустите:
```bash
composer dump-autoload
```

### 2. Ошибка миграций
Сбросьте базу данных и запустите миграции заново:
```bash
php artisan migrate:fresh --seed
```

### 3. Проблемы с правами доступа к файлам
Убедитесь, что у PHP есть права на запись в следующие директории:
- `storage/`
- `bootstrap/cache/`

### 4. Ошибка "Mixed Content" при использовании Pinggy
Убедитесь, что вы используете URL вида `*.pinggy.link` и перезапустите сервер.

## Полезные команды

```bash
# Очистка кэша
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# Проверка статуса webhook
php artisan telegram:webhook-info

# Запуск тестов
php artisan test

# Просмотр логов
tail -f storage/logs/laravel.log
```

## Безопасность

- Не храните файл `.env` в системе контроля версий
- Используйте сложные пароли в продакшене
- Регулярно обновляйте зависимости
- Настройте правильные права доступа к файлам

Готово! Теперь вы можете использовать систему EventFlow для управления мероприятиями.

## Чтобы картинки робили
rm public/storage    
php artisan storage:link
